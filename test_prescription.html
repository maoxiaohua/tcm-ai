<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å¤„æ–¹æ”¯ä»˜æµ‹è¯•</title>
</head>
<body>
    <div id="test-area">
        <h2>å¤„æ–¹æ”¯ä»˜åŠŸèƒ½æµ‹è¯•</h2>
        <div id="messages"></div>
        <button onclick="testPrescriptionFlow()">æµ‹è¯•å¤„æ–¹æµç¨‹</button>
    </div>

    <script src="/static/js/prescription_renderer.js?v=20250916-009"></script>
    
    <script>
        function addMessage(message, sender = 'ai') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.innerHTML = `<div class="${sender}">${message}</div>`;
            messagesDiv.appendChild(messageDiv);
        }

        async function testPrescriptionFlow() {
            console.log('ğŸ§ª å¼€å§‹æµ‹è¯•å¤„æ–¹æ”¯ä»˜æµç¨‹...');
            
            // æµ‹è¯•æ•°æ® - æ¨¡æ‹ŸåŒ…å«å¤„æ–¹çš„AIå›å¤
            const testResponse = {
                reply: "ã€è¾¨è¯åˆ†æã€‘æ‚£è€…å¤±çœ ä¸¥é‡ï¼Œå±é˜´è™šç«æ—ºè¯ã€‚ã€å¤„æ–¹å¦‚ä¸‹ã€‘çŸ¥æŸåœ°é»„æ±¤åŠ å‡ï¼šç†Ÿåœ°é»„30gï¼ŒçŸ¥æ¯15gï¼Œé»„æŸ12gï¼Œå±±è¯20gï¼ŒèŒ¯è‹“15gï¼Œæ³½æ³»12gï¼Œä¸¹çš®10gï¼Œé…¸æ£ä»15gï¼Œé¾™éª¨20gï¼Œç‰¡è›20gï¼Œåˆæ¬¢çš®15gï¼Œå¤œäº¤è—¤20gã€‚æ°´ç…æœï¼Œæ¯æ—¥ä¸€å‰‚ï¼Œåˆ†æ—©æ™šæ¸©æœï¼Œè¿æœ14å‰‚ã€‚",
                contains_prescription: true,
                prescription_id: "test-prescription-123",
                is_paid: false
            };
            
            // åˆ›å»ºå¤„æ–¹æ¸²æŸ“å™¨å®ä¾‹
            const renderer = new PrescriptionRenderer();
            
            // æ¸²æŸ“æ¶ˆæ¯
            const renderedContent = renderer.renderMessage(
                testResponse.reply,
                testResponse.is_paid,
                testResponse.prescription_id
            );
            
            addMessage(renderedContent, 'ai');
            
            console.log('âœ… å¤„æ–¹æ¸²æŸ“å®Œæˆï¼Œæ£€æŸ¥æ˜¯å¦å‡ºç°æ”¯ä»˜æŒ‰é’®');
        }

        // å…¨å±€æ”¯ä»˜å‡½æ•°æ¨¡æ‹Ÿ
        function showPaymentModal(prescriptionId, amount) {
            console.log('ğŸ’³ è°ƒç”¨æ”¯ä»˜æ¨¡æ€æ¡†:', { prescriptionId, amount });
            alert(`æ”¯ä»˜æ¨¡æ€æ¡†å¯åŠ¨æˆåŠŸï¼\nå¤„æ–¹ID: ${prescriptionId}\né‡‘é¢: Â¥${amount}`);
        }
    </script>
</body>
</html>