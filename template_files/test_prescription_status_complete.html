<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤„æ–¹çŠ¶æ€å®Œæ•´æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 { color: #667eea; margin-bottom: 10px; }
        .section {
            margin: 25px 0;
            padding: 20px;
            border: 2px solid #e1e8f0;
            border-radius: 8px;
            background: #f8f9ff;
        }
        .test-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-btn:hover { background: #5568d3; }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #ffffff;
            border-left: 4px solid #667eea;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { border-left-color: #10b981; background: #ecfdf5; }
        .error { border-left-color: #ef4444; background: #fef2f2; }
        .info { border-left-color: #3b82f6; background: #eff6ff; }
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: bold;
            margin: 5px;
            font-size: 13px;
        }
        .badge-approved { background: #d1fae5; color: #059669; }
        .badge-pending { background: #fef3c7; color: #d97706; }
        .badge-rejected { background: #fee2e2; color: #dc2626; }
        input[type="number"] { padding: 8px; width: 150px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å¤„æ–¹çŠ¶æ€å®Œæ•´æµ‹è¯•å·¥å…·</h1>
        <p style="color: #666;">æµ‹è¯•ç”¨æˆ·: maoxiaohua (usr_20250920_5741e17a78e8) | å¤„æ–¹ID: 146</p>

        <!-- æµ‹è¯•1: æ•°æ®åº“çŠ¶æ€ -->
        <div class="section">
            <h3>ğŸ“Š æµ‹è¯•1: æ•°æ®åº“çŠ¶æ€</h3>
            <p>å¤„æ–¹ID: <input type="number" id="prescriptionId" value="146"></p>
            <button class="test-btn" onclick="testDatabaseStatus()">æ£€æŸ¥æ•°æ®åº“çŠ¶æ€</button>
            <div id="dbResult" class="result" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•2: APIå“åº” -->
        <div class="section">
            <h3>ğŸŒ æµ‹è¯•2: APIå“åº”</h3>
            <button class="test-btn" onclick="testAPIResponse()">æµ‹è¯• /api/prescription-review/status</button>
            <button class="test-btn" onclick="testConsultationDetail()">æµ‹è¯• /api/consultation/detail</button>
            <button class="test-btn" onclick="testPatientHistory()">æµ‹è¯• /api/consultation/patient/history</button>
            <div id="apiResult" class="result" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•3: LocalStorageçŠ¶æ€ -->
        <div class="section">
            <h3>ğŸ’¾ æµ‹è¯•3: LocalStorageçŠ¶æ€</h3>
            <button class="test-btn" onclick="checkLocalStorage()">æ£€æŸ¥localStorage</button>
            <button class="test-btn" onclick="clearLocalStorage()" style="background: #ef4444;">æ¸…é™¤é”™è¯¯çŠ¶æ€</button>
            <div id="storageResult" class="result" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•4: å‰ç«¯çŠ¶æ€åˆ¤æ–­é€»è¾‘ -->
        <div class="section">
            <h3>ğŸ¯ æµ‹è¯•4: çŠ¶æ€åˆ¤æ–­æ¨¡æ‹Ÿ</h3>
            <p>æ¨¡æ‹Ÿå‰ç«¯å¦‚ä½•åˆ¤æ–­å¤„æ–¹çŠ¶æ€</p>
            <button class="test-btn" onclick="simulateStatusLogic()">æ¨¡æ‹ŸçŠ¶æ€åˆ¤æ–­</button>
            <div id="logicResult" class="result" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•5: å®Œæ•´æµç¨‹éªŒè¯ -->
        <div class="section">
            <h3>âœ… æµ‹è¯•5: ç«¯åˆ°ç«¯éªŒè¯</h3>
            <button class="test-btn" onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <div id="fullTestResult" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        const userId = 'usr_20250920_5741e17a78e8';
        const consultationId = '88ff-e1d7-4714-9420-ccc1';

        async function testDatabaseStatus() {
            const prescriptionId = document.getElementById('prescriptionId').value;
            const resultDiv = document.getElementById('dbResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æŸ¥è¯¢æ•°æ®åº“...';

            try {
                const response = await fetch(`/api/prescription-review/status/${prescriptionId}`);
                const data = await response.json();

                if (data.success) {
                    const status = data.data;
                    let result = `âœ… æ•°æ®åº“çŠ¶æ€æŸ¥è¯¢æˆåŠŸ\n\n`;
                    result += `å¤„æ–¹ID: ${status.prescription_id}\n`;
                    result += `çŠ¶æ€ (status): ${status.status}\n`;
                    result += `å®¡æ ¸çŠ¶æ€æè¿°: ${status.status_description}\n`;
                    result += `æ”¯ä»˜çŠ¶æ€ (payment_status): ${status.payment_status}\n`;
                    result += `æ˜¯å¦å·²å®¡æ ¸ (is_reviewed): ${status.is_reviewed}\n`;
                    result += `æ˜¯å¦æœ‰ä¿®æ”¹ (is_modified): ${status.is_modified}\n`;
                    result += `å®¡æ ¸æ—¶é—´: ${status.reviewed_at || 'æœªå®¡æ ¸'}\n`;
                    result += `æäº¤æ—¶é—´: ${status.submitted_at || 'æœªæäº¤'}\n\n`;

                    // åˆ¤æ–­çŠ¶æ€
                    if (status.status === 'doctor_approved' && status.is_reviewed === true) {
                        result += `\nâœ… çŠ¶æ€æ­£ç¡®: åŒ»ç”Ÿå·²å®¡æ ¸é€šè¿‡\n`;
                        result += `åº”æ˜¾ç¤º: "åŒ»ç”Ÿå®¡æ ¸å®Œæˆï¼Œå¯ä»¥é…è¯"\n`;
                        resultDiv.className = 'result success';
                    } else if (status.status === 'pending_review') {
                        result += `\nâ³ çŠ¶æ€: ç­‰å¾…åŒ»ç”Ÿå®¡æ ¸\n`;
                        resultDiv.className = 'result';
                    } else {
                        result += `\nâš ï¸ çŠ¶æ€å¼‚å¸¸: ${status.status}\n`;
                        resultDiv.className = 'result error';
                    }

                    result += `\nå¤„æ–¹å†…å®¹é•¿åº¦: ${status.final_prescription ? status.final_prescription.length : 0} å­—ç¬¦`;
                    resultDiv.textContent = result;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ æŸ¥è¯¢å¤±è´¥: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`;
            }
        }

        async function testAPIResponse() {
            const prescriptionId = document.getElementById('prescriptionId').value;
            const resultDiv = document.getElementById('apiResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•API...';

            try {
                const response = await fetch(`/api/prescription-review/status/${prescriptionId}`);
                const data = await response.json();

                let result = `API: /api/prescription-review/status/${prescriptionId}\n\n`;
                result += `å“åº”çŠ¶æ€ç : ${response.status}\n`;
                result += `success: ${data.success}\n\n`;

                if (data.success) {
                    result += `è¿”å›æ•°æ®ç»“æ„:\n`;
                    result += JSON.stringify(data.data, null, 2);
                    resultDiv.className = 'result success';
                } else {
                    result += `é”™è¯¯: ${data.message}`;
                    resultDiv.className = 'result error';
                }

                resultDiv.textContent = result;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ APIè¯·æ±‚å¤±è´¥: ${error.message}`;
            }
        }

        async function testConsultationDetail() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æŸ¥è¯¢é—®è¯Šè¯¦æƒ…...';

            try {
                const response = await fetch(`/api/consultation/detail/${consultationId}`);
                const data = await response.json();

                let result = `API: /api/consultation/detail/${consultationId}\n\n`;
                result += `success: ${data.success}\n\n`;

                if (data.success && data.data.prescription_info) {
                    const prescInfo = data.data.prescription_info;
                    result += `å¤„æ–¹ä¿¡æ¯:\n`;
                    result += `- prescription_id: ${prescInfo.prescription_id}\n`;
                    result += `- status: ${prescInfo.status}\n`;
                    result += `- review_status: ${prescInfo.review_status}\n`;
                    result += `- payment_status: ${prescInfo.payment_status}\n`;
                    result += `- is_visible: ${prescInfo.is_visible}\n`;
                    result += `- display_text é•¿åº¦: ${prescInfo.display_text ? prescInfo.display_text.length : 0}\n\n`;

                    if (prescInfo.status === 'doctor_approved' && prescInfo.review_status === 'approved') {
                        result += `âœ… é—®è¯Šè¯¦æƒ…APIè¿”å›æ­£ç¡®çŠ¶æ€\n`;
                        resultDiv.className = 'result success';
                    } else {
                        result += `âš ï¸ çŠ¶æ€å¯èƒ½æœ‰è¯¯\n`;
                        resultDiv.className = 'result';
                    }
                } else {
                    result += `âŒ æ²¡æœ‰å¤„æ–¹ä¿¡æ¯`;
                    resultDiv.className = 'result error';
                }

                resultDiv.textContent = result;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`;
            }
        }

        async function testPatientHistory() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æŸ¥è¯¢æ‚£è€…å†å²...';

            try {
                const response = await fetch(`/api/consultation/patient/history?user_id=${userId}`);
                const data = await response.json();

                let result = `API: /api/consultation/patient/history\n\n`;
                result += `success: ${data.success}\n`;
                result += `æ€»è®°å½•æ•°: ${data.data.total_count}\n\n`;

                const targetConsultation = data.data.consultation_history.find(c => c.consultation_id === consultationId);
                if (targetConsultation) {
                    result += `æ‰¾åˆ°ç›®æ ‡é—®è¯Š:\n`;
                    result += `- consultation_id: ${targetConsultation.consultation_id}\n`;
                    result += `- has_prescription: ${targetConsultation.has_prescription}\n`;

                    if (targetConsultation.prescription_info) {
                        const prescInfo = targetConsultation.prescription_info;
                        result += `\nå¤„æ–¹ä¿¡æ¯:\n`;
                        result += `- prescription_id: ${prescInfo.prescription_id}\n`;
                        result += `- status: ${prescInfo.status}\n`;
                        result += `- review_status: ${prescInfo.review_status}\n`;
                        result += `- display_text: "${prescInfo.display_text.substring(0, 50)}..."\n\n`;

                        if (prescInfo.status === 'doctor_approved' && prescInfo.review_status === 'approved') {
                            result += `âœ… å†å²è®°å½•APIè¿”å›æ­£ç¡®çŠ¶æ€\n`;
                            resultDiv.className = 'result success';
                        } else {
                            result += `âš ï¸ çŠ¶æ€æœ‰è¯¯: status=${prescInfo.status}, review_status=${prescInfo.review_status}\n`;
                            resultDiv.className = 'result error';
                        }
                    }
                } else {
                    result += `âŒ æœªæ‰¾åˆ°ç›®æ ‡é—®è¯Š`;
                    resultDiv.className = 'result error';
                }

                resultDiv.textContent = result;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`;
            }
        }

        function checkLocalStorage() {
            const resultDiv = document.getElementById('storageResult');
            resultDiv.style.display = 'block';

            const storageKey = `prescription_status_${userId}`;
            const storedData = localStorage.getItem(storageKey);

            let result = `ğŸ” æ£€æŸ¥ localStorage:\n`;
            result += `Key: ${storageKey}\n\n`;

            if (storedData) {
                try {
                    const data = JSON.parse(storedData);
                    result += `å­˜å‚¨çš„æ•°æ®:\n`;
                    result += JSON.stringify(data, null, 2);

                    const prescriptionId = document.getElementById('prescriptionId').value;
                    if (data[prescriptionId]) {
                        result += `\n\nå¤„æ–¹ ${prescriptionId} çš„çŠ¶æ€: ${data[prescriptionId].status}\n`;
                        if (data[prescriptionId].status === 'pending_review') {
                            result += `\nâš ï¸ localStorageå­˜å‚¨äº†é”™è¯¯çš„ pending_review çŠ¶æ€ï¼`;
                            result += `\nè¿™ä¼šå¯¼è‡´å‰ç«¯æ˜¾ç¤ºé”™è¯¯ã€‚`;
                            resultDiv.className = 'result error';
                        } else if (data[prescriptionId].status === 'approved') {
                            result += `\nâœ… localStorageçŠ¶æ€æ­£ç¡®`;
                            resultDiv.className = 'result success';
                        }
                    } else {
                        result += `\n\nâš ï¸ localStorageä¸­æ²¡æœ‰å¤„æ–¹ ${prescriptionId} çš„çŠ¶æ€`;
                        resultDiv.className = 'result';
                    }
                } catch (e) {
                    result += `\nâŒ è§£æå¤±è´¥: ${e.message}`;
                    resultDiv.className = 'result error';
                }
            } else {
                result += `localStorageä¸ºç©º`;
                resultDiv.className = 'result';
            }

            resultDiv.textContent = result;
        }

        function clearLocalStorage() {
            const storageKey = `prescription_status_${userId}`;
            const prescriptionId = document.getElementById('prescriptionId').value;

            try {
                const storedData = localStorage.getItem(storageKey);
                if (storedData) {
                    const data = JSON.parse(storedData);
                    if (data[prescriptionId]) {
                        delete data[prescriptionId];
                        localStorage.setItem(storageKey, JSON.stringify(data));

                        const resultDiv = document.getElementById('storageResult');
                        resultDiv.style.display = 'block';
                        resultDiv.className = 'result success';
                        resultDiv.textContent = `âœ… å·²æ¸…é™¤å¤„æ–¹ ${prescriptionId} çš„localStorageçŠ¶æ€\n\nè¯·åˆ·æ–°æ‚£è€…å‰ç«¯é¡µé¢æŸ¥çœ‹æ•ˆæœ`;
                    } else {
                        alert('localStorageä¸­æ²¡æœ‰è¯¥å¤„æ–¹çš„çŠ¶æ€');
                    }
                } else {
                    alert('localStorageä¸ºç©º');
                }
            } catch (e) {
                alert('æ¸…é™¤å¤±è´¥: ' + e.message);
            }
        }

        async function simulateStatusLogic() {
            const resultDiv = document.getElementById('logicResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æ¨¡æ‹Ÿå‰ç«¯é€»è¾‘...';

            try {
                const prescriptionId = document.getElementById('prescriptionId').value;
                const response = await fetch(`/api/prescription-review/status/${prescriptionId}`);
                const result = await response.json();

                if (result.success) {
                    const statusData = result.data;
                    let output = `æ¨¡æ‹Ÿå‰ç«¯çŠ¶æ€åˆ¤æ–­:\n\n`;
                    output += `ä»APIè·å–çš„æ•°æ®:\n`;
                    output += `- status: "${statusData.status}"\n`;
                    output += `- is_reviewed: ${statusData.is_reviewed}\n`;
                    output += `- payment_status: "${statusData.payment_status}"\n\n`;

                    output += `å‰ç«¯åˆ¤æ–­é€»è¾‘:\n`;
                    output += `-`.repeat(50) + `\n`;

                    if (statusData.is_reviewed === true && statusData.status === 'doctor_approved') {
                        output += `âœ… æ¡ä»¶åŒ¹é…: is_reviewed === true && status === 'doctor_approved'\n`;
                        output += `\nåº”è¯¥æ˜¾ç¤º:\n`;
                        output += `  æ ‡é¢˜: "åŒ»ç”Ÿå®¡æ ¸é€šè¿‡"\n`;
                        output += `  å›¾æ ‡: âœ…\n`;
                        output += `  å†…å®¹: å®Œæ•´å¤„æ–¹è¯¦æƒ…\n`;
                        output += `  æç¤º: "åŒ»ç”Ÿå®¡æ ¸å·²å®Œæˆï¼Œæ‚¨å¯ä»¥å‡­æ­¤å¤„æ–¹é…è¯"\n`;
                        resultDiv.className = 'result success';
                    } else if (statusData.status === 'pending_review') {
                        output += `â³ æ¡ä»¶åŒ¹é…: status === 'pending_review'\n`;
                        output += `\nåº”è¯¥æ˜¾ç¤º:\n`;
                        output += `  æ ‡é¢˜: "å¤„æ–¹æ­£åœ¨åŒ»ç”Ÿå®¡æ ¸ä¸­"\n`;
                        output += `  å›¾æ ‡: â³\n`;
                        output += `  æç¤º: "è¯·è€å¿ƒç­‰å¾…åŒ»ç”Ÿå®¡æ ¸"\n`;
                        resultDiv.className = 'result';
                    } else {
                        output += `âš ï¸ æœªåŒ¹é…ä»»ä½•æ¡ä»¶\n`;
                        output += `å½“å‰çŠ¶æ€: ${statusData.status}\n`;
                        output += `is_reviewed: ${statusData.is_reviewed}\n`;
                        resultDiv.className = 'result error';
                    }

                    resultDiv.textContent = output;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ è·å–çŠ¶æ€å¤±è´¥: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ æ¨¡æ‹Ÿå¤±è´¥: ${error.message}`;
            }
        }

        async function runFullTest() {
            const resultDiv = document.getElementById('fullTestResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•...';

            let report = `ğŸ” å®Œæ•´æµ‹è¯•æŠ¥å‘Š\n`;
            report += `=`.repeat(60) + `\n\n`;

            try {
                const prescriptionId = document.getElementById('prescriptionId').value;

                // æµ‹è¯•1: æ•°æ®åº“çŠ¶æ€
                report += `[1/4] æµ‹è¯•æ•°æ®åº“çŠ¶æ€...\n`;
                const apiResponse = await fetch(`/api/prescription-review/status/${prescriptionId}`);
                const apiData = await apiResponse.json();

                if (apiData.success && apiData.data.status === 'doctor_approved' && apiData.data.is_reviewed === true) {
                    report += `  âœ… æ•°æ®åº“çŠ¶æ€æ­£ç¡®\n`;
                } else {
                    report += `  âŒ æ•°æ®åº“çŠ¶æ€é”™è¯¯: ${apiData.data.status}\n`;
                    resultDiv.className = 'result error';
                }

                // æµ‹è¯•2: é—®è¯Šè¯¦æƒ…API
                report += `\n[2/4] æµ‹è¯•é—®è¯Šè¯¦æƒ…API...\n`;
                const detailResponse = await fetch(`/api/consultation/detail/${consultationId}`);
                const detailData = await detailResponse.json();

                if (detailData.success && detailData.data.prescription_info && detailData.data.prescription_info.status === 'doctor_approved') {
                    report += `  âœ… é—®è¯Šè¯¦æƒ…APIè¿”å›æ­£ç¡®\n`;
                } else {
                    report += `  âŒ é—®è¯Šè¯¦æƒ…APIè¿”å›é”™è¯¯\n`;
                    resultDiv.className = 'result error';
                }

                // æµ‹è¯•3: å†å²è®°å½•API
                report += `\n[3/4] æµ‹è¯•å†å²è®°å½•API...\n`;
                const historyResponse = await fetch(`/api/consultation/patient/history?user_id=${userId}`);
                const historyData = await historyResponse.json();

                const targetConsultation = historyData.data.consultation_history.find(c => c.consultation_id === consultationId);
                if (targetConsultation && targetConsultation.prescription_info && targetConsultation.prescription_info.status === 'doctor_approved') {
                    report += `  âœ… å†å²è®°å½•APIè¿”å›æ­£ç¡®\n`;
                } else {
                    report += `  âŒ å†å²è®°å½•APIè¿”å›é”™è¯¯æˆ–æœªæ‰¾åˆ°\n`;
                    resultDiv.className = 'result error';
                }

                // æµ‹è¯•4: LocalStorageæ£€æŸ¥
                report += `\n[4/4] æ£€æŸ¥localStorage...\n`;
                const storageKey = `prescription_status_${userId}`;
                const storedData = localStorage.getItem(storageKey);
                if (storedData) {
                    const data = JSON.parse(storedData);
                    if (data[prescriptionId]) {
                        if (data[prescriptionId].status === 'pending_review') {
                            report += `  âš ï¸ localStorageå­˜å‚¨äº†é”™è¯¯çš„ pending_review çŠ¶æ€\n`;
                            report += `  å»ºè®®: æ¸…é™¤localStorageç¼“å­˜\n`;
                            resultDiv.className = 'result error';
                        } else if (data[prescriptionId].status === 'approved') {
                            report += `  âœ… localStorageçŠ¶æ€æ­£ç¡®\n`;
                        }
                    } else {
                        report += `  â„¹ï¸ localStorageä¸­æ²¡æœ‰è¯¥å¤„æ–¹çŠ¶æ€\n`;
                    }
                } else {
                    report += `  â„¹ï¸ localStorageä¸ºç©º\n`;
                }

                report += `\n` + `=`.repeat(60) + `\n`;
                report += `\næ€»ç»“:\n`;
                if (resultDiv.className === 'result error') {
                    report += `âŒ æµ‹è¯•å‘ç°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ä¸Šé¢çš„é”™è¯¯è¯¦æƒ…\n`;
                } else {
                    report += `âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼\n`;
                    resultDiv.className = 'result success';
                }

                report += `\nå»ºè®®æ“ä½œ:\n`;
                report += `1. å¦‚æœlocalStorageæœ‰é”™è¯¯çŠ¶æ€ï¼Œç‚¹å‡»"æ¸…é™¤é”™è¯¯çŠ¶æ€"æŒ‰é’®\n`;
                report += `2. åˆ·æ–°æ‚£è€…å‰ç«¯é¡µé¢\n`;
                report += `3. æŸ¥çœ‹å¤„æ–¹çŠ¶æ€æ˜¯å¦æ­£ç¡®æ˜¾ç¤º\n`;

            } catch (error) {
                report += `\nâŒ æµ‹è¯•è¿‡ç¨‹å‡ºé”™: ${error.message}\n`;
                resultDiv.className = 'result error';
            }

            resultDiv.textContent = report;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œå®Œæ•´æµ‹è¯•
        window.addEventListener('load', function() {
            console.log('é¡µé¢å·²åŠ è½½ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
        });
    </script>
</body>
</html>
