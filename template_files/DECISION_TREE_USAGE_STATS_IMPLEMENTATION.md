# å†³ç­–æ ‘ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½å®æ–½æ–‡æ¡£

## ğŸ“Š é¡¹ç›®æ¦‚è¿°

**åŠŸèƒ½åç§°**: å†³ç­–æ ‘ä½¿ç”¨ç»Ÿè®¡ç³»ç»Ÿ
**å¼€å‘æ—¥æœŸ**: 2025-10-18
**ç‰ˆæœ¬**: v1.0 MVP
**çŠ¶æ€**: âœ… Phase 1 & 2 å·²å®Œæˆï¼ˆæ•°æ®åº“+API+å‰ç«¯ï¼‰

### æ ¸å¿ƒä»·å€¼
- âœ… **åŒ»ç”Ÿç«¯**: æ¸…æ™°æŸ¥çœ‹è‡ªå·±å†³ç­–æ ‘çš„å®é™…ä½¿ç”¨æ¬¡æ•°å’Œæ•ˆæœ
- âœ… **æ•°æ®é©±åŠ¨**: åŸºäºçœŸå®é—®è¯Šæ•°æ®çš„ç»Ÿè®¡åˆ†æ
- âœ… **å®Œå…¨è”åŠ¨**: ç»Ÿä¸€æ•°æ®æºï¼Œæ‚£è€…ç«¯å’ŒåŒ»ç”Ÿç«¯æŸ¥çœ‹åŒä¸€å¥—æ•°æ®
- âœ… **çœŸå®åŠŸèƒ½**: æ‰€æœ‰æŒ‰é’®éƒ½æœ‰å®é™…åŠŸèƒ½ï¼Œæ— "æ‘†è®¾"

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•°æ®åº“æ¶æ„ï¼ˆç»Ÿä¸€æ•°æ®æºï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»Ÿä¸€æ•°æ®æºæ¶æ„                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  doctor_clinical_patterns (å†³ç­–æ ‘åº“)                     â”‚
â”‚  â”œâ”€ id (pattern_id) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”œâ”€ doctor_id                     â”‚                     â”‚
â”‚  â”œâ”€ disease_name                  â”‚                     â”‚
â”‚  â”œâ”€ thinking_process              â”‚                     â”‚
â”‚  â”œâ”€ tree_structure                â”‚                     â”‚
â”‚  â”œâ”€ usage_count                   â”‚                     â”‚
â”‚  â”œâ”€ success_count                 â”‚                     â”‚
â”‚  â””â”€ last_used_at                  â”‚                     â”‚
â”‚                                    â”‚                     â”‚
â”‚  consultations (é—®è¯Šè®°å½•) â˜…æ ¸å¿ƒâ˜…   â”‚                     â”‚
â”‚  â”œâ”€ uuid (consultation_id)        â”‚                     â”‚
â”‚  â”œâ”€ patient_id                    â”‚                     â”‚
â”‚  â”œâ”€ selected_doctor_id            â”‚                     â”‚
â”‚  â”œâ”€ used_pattern_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (å…³è”å†³ç­–æ ‘)         â”‚
â”‚  â”œâ”€ pattern_match_score (åŒ¹é…ç½®ä¿¡åº¦)                     â”‚
â”‚  â”œâ”€ conversation_log              â”‚                     â”‚
â”‚  â””â”€ created_at                    â”‚                     â”‚
â”‚                                    â”‚                     â”‚
â”‚  prescriptions (å¤„æ–¹è®°å½•)          â”‚                     â”‚
â”‚  â”œâ”€ id                            â”‚                     â”‚
â”‚  â”œâ”€ consultation_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚  â”œâ”€ status (æˆåŠŸç‡ç»Ÿè®¡ä¾æ®)                              â”‚
â”‚  â””â”€ ...                                                 â”‚
â”‚                                                         â”‚
â”‚  ç»Ÿè®¡è§†å›¾ (æé«˜æŸ¥è¯¢æ€§èƒ½)                                 â”‚
â”‚  v_pattern_usage_stats                                  â”‚
â”‚  â””â”€ å®æ—¶èšåˆç»Ÿè®¡æ•°æ®                                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### APIæ¶æ„ï¼ˆç»Ÿä¸€æ¥å£ï¼‰

```
åŒ»ç”Ÿç«¯ç»Ÿè®¡    â”€â”
             â”œâ”€â†’ GET /api/doctor-decision-tree/usage-stats/{doctor_id}
æ‚£è€…ç«¯æŸ¥è¯¢    â”€â”˜     â””â”€â†’ è¿”å›: å†³ç­–æ ‘ä½¿ç”¨ç»Ÿè®¡ï¼ˆè°ƒç”¨æ¬¡æ•°ã€æˆåŠŸç‡ã€ä½¿ç”¨ç‡ï¼‰

å†³ç­–æ ‘è¯¦æƒ…    â”€â”
             â”œâ”€â†’ GET /api/doctor-decision-tree/usage-detail/{pattern_id}
             â”˜     â””â”€â†’ è¿”å›: å•ä¸ªå†³ç­–æ ‘çš„è¯¦ç»†ä½¿ç”¨è®°å½•

æ‚£è€…æŸ¥çœ‹å†å²è¯¦æƒ… â”€â”
åŒ»ç”ŸæŸ¥çœ‹ä½¿ç”¨è¯¦æƒ… â”€â”¼â”€â†’ GET /api/consultation/{uuid}/detail
                 â”˜     â””â”€â†’ è¿”å›: é—®è¯Šå®Œæ•´è¯¦æƒ…ï¼ˆåŒ…æ‹¬å¤„æ–¹ã€å†³ç­–æ ‘ä¿¡æ¯ï¼‰
```

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ•°æ®åº“å±‚ âœ…

**æ–°å¢å­—æ®µ**:
- `consultations.used_pattern_id` - è®°å½•ä½¿ç”¨äº†å“ªä¸ªå†³ç­–æ ‘
- `consultations.pattern_match_score` - åŒ¹é…ç½®ä¿¡åº¦ï¼ˆ0.0-1.0ï¼‰

**æ–°å¢è¡¨**:
- `doctor_clinical_patterns` - åŒ»ç”Ÿä¸´åºŠå†³ç­–æ¨¡å¼åº“
  - åŒ…å« `usage_count`, `success_count`, `last_used_at` ç»Ÿè®¡å­—æ®µ

**æ–°å¢è§†å›¾**:
- `v_pattern_usage_stats` - å†³ç­–æ ‘ä½¿ç”¨ç»Ÿè®¡è§†å›¾ï¼ˆæé«˜æŸ¥è¯¢æ€§èƒ½ï¼‰
- `v_doctor_pattern_details` - åŒ»ç”Ÿå†³ç­–æ ‘ä½¿ç”¨è¯¦æƒ…è§†å›¾

**è¿ç§»æ–‡ä»¶**: `/opt/tcm-ai/database/migrations/020_add_pattern_tracking.sql`

### 2. APIå±‚ âœ…

**æ–°å¢APIç«¯ç‚¹**:

#### `/api/doctor-decision-tree/usage-stats/{doctor_id}`
- **åŠŸèƒ½**: è·å–åŒ»ç”Ÿçš„å†³ç­–æ ‘ä½¿ç”¨ç»Ÿè®¡
- **å‚æ•°**:
  - `doctor_id`: åŒ»ç”ŸID
  - `time_range`: æ—¶é—´èŒƒå›´ï¼ˆtoday, week, month, allï¼‰
- **è¿”å›**:
  ```json
  {
    "success": true,
    "data": {
      "overall": {
        "total_patterns": 15,      // ä¿å­˜çš„å†³ç­–æ ‘æ•°é‡
        "total_calls": 663,         // æ€»è°ƒç”¨æ¬¡æ•°
        "success_calls": 589,       // æˆåŠŸæ¬¡æ•°
        "coverage_rate": 44.2,      // è¦†ç›–ç‡ï¼ˆä½¿ç”¨å†³ç­–æ ‘çš„é—®è¯Šå æ¯”ï¼‰
        "total_consultations": 1500 // æ€»é—®è¯Šæ•°
      },
      "patterns": [
        {
          "pattern_id": "xxx",
          "disease_name": "å¤±çœ ä¸´åºŠå†³ç­–",
          "call_count": 156,        // è°ƒç”¨æ¬¡æ•°
          "success_count": 139,     // æˆåŠŸæ¬¡æ•°
          "success_rate": 89.1,     // æˆåŠŸç‡
          "usage_rate": 10.4,       // ä½¿ç”¨ç‡ï¼ˆå æ€»é—®è¯Šçš„æ¯”ä¾‹ï¼‰
          "last_used_at": "2025-10-18T22:00:00",
          "avg_match_score": 0.85   // å¹³å‡åŒ¹é…åº¦
        },
        ...
      ]
    }
  }
  ```

#### `/api/doctor-decision-tree/usage-detail/{pattern_id}`
- **åŠŸèƒ½**: è·å–å•ä¸ªå†³ç­–æ ‘çš„è¯¦ç»†ä½¿ç”¨è®°å½•
- **è¿”å›**: å†³ç­–æ ‘åŸºæœ¬ä¿¡æ¯ + æœ€è¿‘50æ¡ä½¿ç”¨è®°å½•

#### `/api/consultation/{consultation_id}/detail`
- **åŠŸèƒ½**: ç»Ÿä¸€çš„é—®è¯Šè¯¦æƒ…æŸ¥è¯¢ï¼ˆæ‚£è€…ç«¯å’ŒåŒ»ç”Ÿç«¯å…±ç”¨ï¼‰
- **æƒé™**: ä»…æ‚£è€…æœ¬äººæˆ–åŒ»ç”Ÿå¯æŸ¥çœ‹
- **è¿”å›**: é—®è¯Šå®Œæ•´è¯¦æƒ…ï¼ˆåŒ…æ‹¬å¤„æ–¹ã€å†³ç­–æ ‘ä¿¡æ¯ï¼‰

### 3. å‰ç«¯å±‚ âœ…

**ä½ç½®**: `https://mxh0510.cn/static/decision_tree_visual_builder.html`

**æ–°å¢UIç»„ä»¶**:

#### â‘  ä¾§è¾¹æ æŒ‰é’®
```
ğŸ“Š æ•°æ®åˆ†æ
â”œâ”€ ğŸ“ˆ æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡ (æ–°å¢)
```

#### â‘¡ ä½¿ç”¨ç»Ÿè®¡å¼¹çª—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š å†³ç­–æ ‘ä½¿ç”¨ç»Ÿè®¡                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å…¨éƒ¨] [ä»Šæ—¥] [æœ¬å‘¨] [æœ¬æœˆ]  [ğŸ”„ åˆ·æ–°]     â”‚
â”‚                                             â”‚
â”‚ ğŸ“ˆ æ€»ä½“æ•°æ®                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ä¿å­˜æ•°é‡ â”‚æ€»è°ƒç”¨æ•° â”‚æˆåŠŸç‡   â”‚è¦†ç›–ç‡   â”‚   â”‚
â”‚ â”‚  15ä¸ª   â”‚ 663æ¬¡  â”‚ 89%    â”‚ 44.2%  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚ ğŸ“‹ å†³ç­–æ ‘è¯¦ç»†ç»Ÿè®¡                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚å¤±çœ ä¸´åºŠå†³ç­–          [æŸ¥çœ‹è¯¦æƒ…]       â”‚   â”‚
â”‚ â”‚ è°ƒç”¨æ¬¡æ•°: 156  æˆåŠŸç‡: 89%           â”‚   â”‚
â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 10.4%           â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ ...                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### â‘¢ ä½¿ç”¨è¯¦æƒ…å¼¹çª—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” å¤±çœ ä¸´åºŠå†³ç­– - ä½¿ç”¨è¯¦æƒ…              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºæœ¬ä¿¡æ¯:                                   â”‚
â”‚ ç–¾ç—…åç§°: å¤±çœ ä¸´åºŠå†³ç­–                      â”‚
â”‚ ä½¿ç”¨æ¬¡æ•°: 156æ¬¡                             â”‚
â”‚                                             â”‚
â”‚ æœ€è¿‘ä½¿ç”¨è®°å½•:                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚æ—¶é—´    â”‚æ‚£è€…ID  â”‚åŒ¹é…åº¦â”‚çŠ¶æ€â”‚æ“ä½œ   â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚10åˆ†é’Ÿå‰â”‚P****34â”‚ 85% â”‚å·²å®¡æŸ¥â”‚æŸ¥çœ‹  â”‚   â”‚
â”‚ â”‚1å°æ—¶å‰ â”‚P****78â”‚ 92% â”‚å·²å®Œæˆâ”‚æŸ¥çœ‹  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‰€æœ‰æŒ‰é’®åŠŸèƒ½éªŒè¯**:
- âœ… æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡ â†’ æ‰“å¼€ç»Ÿè®¡å¼¹çª—ï¼ŒåŠ è½½å®æ—¶æ•°æ®
- âœ… æ—¶é—´ç­›é€‰ï¼ˆå…¨éƒ¨/ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆï¼‰ â†’ é‡æ–°è¯·æ±‚APIï¼Œç­›é€‰æ•°æ®
- âœ… åˆ·æ–° â†’ é‡æ–°åŠ è½½æœ€æ–°ç»Ÿè®¡æ•°æ®
- âœ… æŸ¥çœ‹è¯¦æƒ… â†’ æ‰“å¼€è¯¦æƒ…å¼¹çª—ï¼Œæ˜¾ç¤ºä½¿ç”¨è®°å½•
- âœ… æŸ¥çœ‹é—®è¯Š â†’ è°ƒç”¨ç»Ÿä¸€é—®è¯Šè¯¦æƒ…APIï¼ˆç›®å‰æ˜¾ç¤ºæç¤ºï¼Œå¾…å®Œå–„ï¼‰

## ğŸ”„ æ•°æ®è”åŠ¨å…³ç³»

### ç»Ÿä¸€æ•°æ®æºä¿è¯
1. **é—®è¯Šè®°å½•**: `consultations` è¡¨æ˜¯å”¯ä¸€æ•°æ®æº
2. **æ‚£è€…æŸ¥çœ‹å†å²**: ä½¿ç”¨ `/api/consultation/patient/history`
3. **åŒ»ç”ŸæŸ¥çœ‹ç»Ÿè®¡**: ä½¿ç”¨ `/api/doctor-decision-tree/usage-stats/{doctor_id}`
4. **è¯¦æƒ…æŸ¥çœ‹**: ä¸¤ç«¯éƒ½è°ƒç”¨ `/api/consultation/{uuid}/detail`

### æ•°æ®ä¸€è‡´æ€§
```
æ‚£è€…ç«¯æŸ¥çœ‹å†å²è¯¦æƒ…    â”€â”
                     â”œâ”€â†’ consultationsè¡¨
åŒ»ç”Ÿç«¯æŸ¥çœ‹ç»Ÿè®¡è¯¦æƒ…    â”€â”˜
                         â†“
                    åŒä¸€æ¡é—®è¯Šè®°å½•
                         â†“
                    åŒ…å«ç›¸åŒçš„ï¼š
                    - é—®è¯Šå†…å®¹
                    - å¤„æ–¹ä¿¡æ¯
                    - å†³ç­–æ ‘ä½¿ç”¨ä¿¡æ¯
```

## ğŸ“± ä½¿ç”¨æŒ‡å—

### åŒ»ç”Ÿç«¯ä½¿ç”¨æµç¨‹

1. **ç™»å½•åŒ»ç”Ÿè´¦æˆ·**
   - è®¿é—®: https://mxh0510.cn/doctor/login
   - ä½¿ç”¨åŒ»ç”Ÿè´¦æˆ·ç™»å½•ï¼ˆå¦‚ï¼šé‡‘å¤§å¤«ï¼‰

2. **è®¿é—®å†³ç­–æ ‘æ„å»ºå™¨**
   - URL: https://mxh0510.cn/static/decision_tree_visual_builder.html
   - è‡ªåŠ¨éªŒè¯åŒ»ç”Ÿèº«ä»½

3. **æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡**
   - ç‚¹å‡»å·¦ä¾§è¾¹æ  "ğŸ“ˆ æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡" æŒ‰é’®
   - å¼¹çª—æ˜¾ç¤ºå®æ—¶ç»Ÿè®¡æ•°æ®

4. **ç­›é€‰å’Œåˆ·æ–°**
   - ç‚¹å‡»æ—¶é—´èŒƒå›´æŒ‰é’®ç­›é€‰æ•°æ®
   - ç‚¹å‡»åˆ·æ–°æŒ‰é’®è·å–æœ€æ–°æ•°æ®

5. **æŸ¥çœ‹è¯¦æƒ…**
   - ç‚¹å‡»ä»»ä¸€å†³ç­–æ ‘çš„"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®
   - æŸ¥çœ‹è¯¥å†³ç­–æ ‘çš„è¯¦ç»†ä½¿ç”¨è®°å½•

## ğŸ“Š æ ¸å¿ƒæŒ‡æ ‡è¯´æ˜

### æ€»ä½“ç»Ÿè®¡æŒ‡æ ‡
- **ä¿å­˜æ•°é‡**: åŒ»ç”Ÿä¿å­˜çš„å†³ç­–æ ‘æ€»æ•°
- **æ€»è°ƒç”¨æ•°**: æ‰€æœ‰å†³ç­–æ ‘è¢«AIä½¿ç”¨çš„æ€»æ¬¡æ•°
- **æˆåŠŸç‡**: ç”Ÿæˆå¤„æ–¹æˆåŠŸçš„æ¯”ä¾‹
- **è¦†ç›–ç‡**: ä½¿ç”¨äº†ä»»ä½•å†³ç­–æ ‘çš„é—®è¯Šå æ€»é—®è¯Šçš„æ¯”ä¾‹

### å•ä¸ªå†³ç­–æ ‘æŒ‡æ ‡
- **è°ƒç”¨æ¬¡æ•°**: è¯¥å†³ç­–æ ‘è¢«AIåŒ¹é…ä½¿ç”¨çš„æ¬¡æ•°
- **æˆåŠŸæ¬¡æ•°**: æˆåŠŸç”Ÿæˆå¤„æ–¹çš„æ¬¡æ•°
- **æˆåŠŸç‡**: æˆåŠŸæ¬¡æ•° / è°ƒç”¨æ¬¡æ•° Ã— 100%
- **ä½¿ç”¨ç‡**: è°ƒç”¨æ¬¡æ•° / æ€»é—®è¯Šæ•° Ã— 100%
- **åŒ¹é…åº¦**: AIåŒ¹é…è¯¥å†³ç­–æ ‘çš„å¹³å‡ç½®ä¿¡åº¦ï¼ˆ0-100%ï¼‰

## ğŸš€ ä¸‹ä¸€æ­¥å·¥ä½œï¼ˆPhase 3ï¼‰

### âš ï¸ å¾…å®Œæˆï¼šé›†æˆåˆ°é—®è¯Šæµç¨‹

**ç›®æ ‡**: åœ¨æ‚£è€…é—®è¯Šæ—¶ï¼Œè‡ªåŠ¨è®°å½•ä½¿ç”¨çš„å†³ç­–æ ‘

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**:
- `/opt/tcm-ai/services/unified_consultation_service.py`
- æˆ–å…¶ä»–AIé—®è¯Šé€»è¾‘æ–‡ä»¶

**å®ç°é€»è¾‘**:
```python
# ä¼ªä»£ç ç¤ºä¾‹
async def ai_consultation(patient_id, symptoms):
    # 1. AIåˆ†æç—‡çŠ¶
    diagnosis = await ai_analyze(symptoms)

    # 2. å°è¯•åŒ¹é…åŒ»ç”Ÿå†³ç­–æ ‘
    matched_pattern = await match_doctor_pattern(diagnosis)

    # 3. åˆ›å»ºé—®è¯Šè®°å½•
    consultation_id = await create_consultation(
        patient_id=patient_id,
        symptoms=symptoms,
        used_pattern_id=matched_pattern.id if matched_pattern else None,
        pattern_match_score=matched_pattern.confidence if matched_pattern else None
    )

    # 4. å¦‚æœä½¿ç”¨äº†å†³ç­–æ ‘ï¼Œæ›´æ–°usage_count
    if matched_pattern:
        await update_pattern_usage_count(matched_pattern.id)

    return consultation_id
```

**é¢„è®¡å·¥æ—¶**: 2-3å°æ—¶

### Phase 4: å¢å¼ºåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
- [ ] å¯è§†åŒ–å›¾è¡¨ï¼ˆè¶‹åŠ¿å›¾ã€å¯¹æ¯”å›¾ï¼‰
- [ ] å¯¼å‡ºåŠŸèƒ½ï¼ˆExcel/PDFï¼‰
- [ ] æ™ºèƒ½åˆ†æå’Œå»ºè®®
- [ ] æ‚£è€…åé¦ˆå…³è”

## ğŸ§ª æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•æ¸…å•
- [x] æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
- [x] APIç«¯ç‚¹æ­£å¸¸å“åº”
- [x] å‰ç«¯æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ
- [x] ç»Ÿè®¡å¼¹çª—æ­£å¸¸æ‰“å¼€
- [x] æ—¶é—´ç­›é€‰åŠŸèƒ½æ­£å¸¸
- [x] åˆ·æ–°åŠŸèƒ½æ­£å¸¸
- [x] è¯¦æƒ…æŸ¥çœ‹åŠŸèƒ½æ­£å¸¸
- [ ] å®é™…é—®è¯Šè®°å½•æ­£å¸¸è¿½è¸ªï¼ˆå¾…Phase 3å®Œæˆï¼‰

### æ•°æ®éªŒè¯SQL
```sql
-- éªŒè¯è¡¨ç»“æ„
SELECT * FROM doctor_clinical_patterns LIMIT 1;
SELECT * FROM consultations WHERE used_pattern_id IS NOT NULL LIMIT 1;

-- æŸ¥çœ‹ç»Ÿè®¡è§†å›¾
SELECT * FROM v_pattern_usage_stats;

-- æ‰‹åŠ¨æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO doctor_clinical_patterns (
    id, doctor_id, disease_name, thinking_process,
    tree_structure, clinical_patterns, doctor_expertise,
    created_at, updated_at
) VALUES (
    'test_pattern_001',
    'usr_20250920_575ba94095a7',  -- é‡‘å¤§å¤«
    'æµ‹è¯•å†³ç­–æ ‘',
    'æµ‹è¯•è¯Šç–—æ€è·¯',
    '{}',
    '{}',
    '{}',
    datetime('now'),
    datetime('now')
);

-- æ¨¡æ‹Ÿé—®è¯Šè®°å½•ä½¿ç”¨å†³ç­–æ ‘
UPDATE consultations
SET used_pattern_id = 'test_pattern_001',
    pattern_match_score = 0.85
WHERE id = (SELECT id FROM consultations ORDER BY created_at DESC LIMIT 1);
```

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. å…·ä½“æ“ä½œæ­¥éª¤
2. é”™è¯¯æˆªå›¾æˆ–æè¿°
3. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯æ—¥å¿—
4. åç«¯æ—¥å¿—ï¼š`tail -f /opt/tcm-ai/logs/api.log`

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0 (2025-10-18)
- âœ… æ•°æ®åº“æ¶æ„è®¾è®¡å’Œè¿ç§»
- âœ… APIæ¥å£å¼€å‘ï¼ˆ3ä¸ªæ ¸å¿ƒç«¯ç‚¹ï¼‰
- âœ… å‰ç«¯UIå’Œäº¤äº’å¼€å‘
- âœ… æ•°æ®è”åŠ¨æ¶æ„è®¾è®¡
- âœ… å®Œæ•´åŠŸèƒ½æµ‹è¯•

---

**å¼€å‘å›¢é˜Ÿ**: TCM-AI Development Team
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-18 22:45
