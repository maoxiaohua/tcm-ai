<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ»ç”Ÿå›å¤æ ¼å¼æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        
        .test-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-title {
            color: #2d5aa0;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .message {
            display: flex;
            margin-bottom: 15px;
            align-items: flex-start;
        }
        
        .message.ai {
            flex-direction: row;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .message-content {
            flex: 1;
            background: #f8fafc;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .message-text {
            line-height: 1.6;
            color: #374151;
        }
        
        .message-time {
            font-size: 12px;
            color: #6b7280;
            margin-top: 8px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #2d5aa0, #4a7bc8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(45, 90, 160, 0.3);
        }
        
        .raw-content {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 13px;
            color: #374151;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-title">ğŸ”§ åŒ»ç”Ÿå›å¤æ ¼å¼åŒ–æµ‹è¯•</div>
        
        <p><strong>æµ‹è¯•ç›®çš„:</strong> éªŒè¯ä¿®å¤åçš„åŒ»ç”Ÿå›å¤æ ¼å¼åŒ–æ˜¯å¦æ­£ç¡®å¤„ç†æ¢è¡Œå’Œç»“æ„åŒ–æ˜¾ç¤ºã€‚</p>
        
        <div class="test-controls">
            <button class="test-button" onclick="testSimpleDiagnosis()">æµ‹è¯•ç®€å•è¯Šæ–­</button>
            <button class="test-button" onclick="testStructuredDiagnosis()">æµ‹è¯•ç»“æ„åŒ–è¯Šæ–­</button>
            <button class="test-button" onclick="testPrescriptionContent()">æµ‹è¯•å¤„æ–¹å†…å®¹</button>
            <button class="test-button" onclick="testMixedContent()">æµ‹è¯•æ··åˆå†…å®¹</button>
            <button class="test-button" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>
    </div>
    
    <div id="testResults"></div>

    <script src="/static/js/prescription_renderer.js"></script>
    <script>
        // æ¨¡æ‹ŸåŒ»ç”Ÿæ•°æ®
        window.selectedDoctor = 'zhang_zhongjing';
        const doctors = {
            'zhang_zhongjing': { name: 'å¼ ä»²æ™¯', avatar: 'ğŸ‘¨â€âš•ï¸' }
        };

        // æµ‹è¯•æ•°æ®
        const testCases = {
            simpleDiagnosis: `æ ¹æ®æ‚¨æè¿°çš„ç—‡çŠ¶ï¼Œæˆ‘åˆæ­¥åˆ†æå¦‚ä¸‹ï¼š

**ç—‡çŠ¶åˆ†æ**
æ‚¨çš„å¤´ç—›ä¼´æœ‰æ¶å¿ƒç—‡çŠ¶ï¼Œè€ƒè™‘å¯èƒ½ä¸è‚é˜³ä¸Šäº¢æˆ–ç—°æµŠä¸Šè’™æœ‰å…³ã€‚

**è¾¨è¯è®ºæ²»**
åˆæ­¥è¾¨è¯ä¸ºè‚é˜³ä¸Šäº¢è¯ï¼Œå»ºè®®å¹³è‚æ½œé˜³ï¼Œæ¸…çƒ­åŒ–ç—°ã€‚

**ç”Ÿæ´»å»ºè®®**
1. ä¿æŒæƒ…ç»ªç¨³å®šï¼Œé¿å…è¿‡åº¦åŠ³ç´¯
2. é¥®é£Ÿå®œæ¸…æ·¡ï¼Œå°‘é£Ÿè¾›è¾£åˆºæ¿€
3. è§„å¾‹ä½œæ¯ï¼Œä¿è¯å……è¶³ç¡çœ 

å¦‚éœ€è¿›ä¸€æ­¥è¯Šç–—ï¼Œå»ºè®®æä¾›èˆŒè±¡è„‰è±¡ä¿¡æ¯ã€‚`,

            structuredDiagnosis: `## ä¸­åŒ»å››è¯Šåˆ†æ

### 1. æœ›è¯Š
æ ¹æ®æ‚¨çš„æè¿°ï¼Œé¢è‰²åé»„ï¼Œç²¾ç¥ä¸æŒ¯ï¼Œç¬¦åˆè„¾è™šæ¹¿å›°çš„è¡¨ç°ã€‚

### 2. é—»è¯Š  
æ‚¨æåˆ°é£Ÿæ¬²ä¸æŒ¯ï¼Œè…¹èƒ€å—³æ°”ï¼Œè¿™äº›éƒ½æ˜¯è„¾èƒƒè™šå¼±çš„å…¸å‹ç—‡çŠ¶ã€‚

### 3. é—®è¯Š
- **ä¸»ç—‡**ï¼šè…¹èƒ€ã€é£Ÿæ¬²ä¸æŒ¯
- **å…¼ç—‡**ï¼šä¹åŠ›ã€ä¾¿æº
- **ç—…ç¨‹**ï¼š3ä¸ªæœˆä½™

### 4. åˆ‡è¯Š
å»ºè®®æ‚¨ä¸Šä¼ èˆŒè±¡å›¾ç‰‡ï¼Œä»¥ä¾¿è¿›è¡Œå‡†ç¡®çš„æœ›è¯Šåˆ†æã€‚

---

## è¾¨è¯åˆ†æ

**è¯å€™**ï¼šè„¾èƒƒè™šå¼±ï¼Œæ¹¿å›°ä¸­ç„¦
**ç—…æœº**ï¼šè„¾è™šå¤±è¿ï¼Œæ°´æ¹¿å†…åœï¼Œæ¸…é˜³ä¸å‡
**æ²»æ³•**ï¼šå¥è„¾ç›Šæ°”ï¼ŒåŒ–æ¹¿å’Œèƒƒ`,

            prescriptionContent: `## è¾¨è¯è®ºæ²»

**è¯å€™è¯Šæ–­**ï¼šè„¾èƒƒè™šå¼±è¯
**æ²»æ³•**ï¼šå¥è„¾ç›Šæ°”ï¼Œå’ŒèƒƒåŒ–æ¹¿

## å¤„æ–¹å»ºè®®

### ã€å›è¯ã€‘
å…šå‚ 15g - å¤§è¡¥å…ƒæ°”ï¼Œå¥è„¾å…»èƒƒ
ç™½æœ¯ 12g - å¥è„¾ç‡¥æ¹¿ï¼Œç›Šæ°”æ­¢æ±—

### ã€è‡£è¯ã€‘  
èŒ¯è‹“ 15g - å¥è„¾æ¸—æ¹¿ï¼Œå®å¿ƒå®‰ç¥
å±±è¯ 20g - è¡¥è„¾å…»èƒƒï¼Œç”Ÿæ´¥ç›Šè‚º

### ã€ä½è¯ã€‘
é™ˆçš® 10g - ç†æ°”å¥è„¾ï¼Œç‡¥æ¹¿åŒ–ç—°
åŠå¤ 10g - ç‡¥æ¹¿åŒ–ç—°ï¼Œé™é€†æ­¢å‘•

### ã€ä½¿è¯ã€‘
ç”˜è‰ 6g - è°ƒå’Œè¯¸è¯ï¼Œç›Šæ°”å’Œä¸­

### ç…æœæ–¹æ³•
**ç”¨æ³•ç”¨é‡**ï¼šæ¯æ—¥1å‰‚ï¼Œæ°´ç…æœï¼Œåˆ†2æ¬¡æ¸©æœ
**ç…ç…®æ–¹æ³•**ï¼šå…ˆç…30åˆ†é’Ÿï¼Œå–æ±300ml
**æœç”¨æ—¶é—´**ï¼šé¥­å‰åŠå°æ—¶æœç”¨

### æ³¨æ„äº‹é¡¹
1. æœè¯æœŸé—´å¿Œé£Ÿç”Ÿå†·ã€æ²¹è…»é£Ÿç‰©
2. ä¿æŒå¿ƒæƒ…èˆ’ç•…ï¼Œé¿å…æƒ…ç»ªæ³¢åŠ¨  
3. å¦‚æœ‰ä¸é€‚ååº”ï¼Œè¯·åŠæ—¶è”ç³»åŒ»ç”Ÿ`,

            mixedContent: `æ‚¨å¥½ï¼æˆ‘æ˜¯å¼ ä»²æ™¯ï¼Œæ ¹æ®æ‚¨çš„ç—‡çŠ¶æè¿°ï¼Œæˆ‘æ¥ä¸ºæ‚¨åˆ†æï¼š

**åˆæ­¥å°è±¡**
ä»æ‚¨æè¿°çš„"ç»å¸¸æ„Ÿåˆ°ç–²åŠ³ï¼Œé£Ÿæ¬²ä¸æŒ¯ï¼Œå¶æœ‰è…¹èƒ€"æ¥çœ‹ï¼Œè¿™å¾ˆç¬¦åˆä¸­åŒ»æ‰€è¯´çš„è„¾èƒƒè™šå¼±è¯å€™ã€‚

**è¯¦ç»†åˆ†æ**
### ç—‡çŠ¶ç‰¹ç‚¹
1. **ç–²åŠ³ä¹åŠ›** - æç¤ºè„¾æ°”è™šå¼±ï¼Œè¿åŒ–å¤±å¸
2. **é£Ÿæ¬²ä¸æŒ¯** - è„¾èƒƒåŠŸèƒ½å‡é€€ï¼Œçº³è¿å¤±å¸¸  
3. **è…¹èƒ€** - æ°”æœºä¸ç•…ï¼Œè„¾è™šæ°”æ»

### ç—…æœºåˆ†æ
- **æ ¹æœ¬åŸå› **ï¼šè„¾èƒƒè™šå¼±ï¼Œè¿åŒ–å¤±èŒ
- **ç—…ç†å˜åŒ–**ï¼šæ¸…é˜³ä¸å‡ï¼ŒæµŠé˜´ä¸é™
- **å‘å±•è¶‹åŠ¿**ï¼šè‹¥ä¸åŠæ—¶è°ƒæ²»ï¼Œå¯èƒ½å‘å±•ä¸ºæ›´ä¸¥é‡çš„è„¾èƒƒç—…è¯

**å»ºè®®ä¸‹ä¸€æ­¥**
ä¸ºäº†ç»™æ‚¨åˆ¶å®šæ›´ç²¾å‡†çš„æ²»ç–—æ–¹æ¡ˆï¼Œå»ºè®®æ‚¨ï¼š
1. ä¸Šä¼ èˆŒè±¡ç…§ç‰‡ï¼ˆä¼¸èˆŒæ‹ç…§ï¼Œå…‰çº¿å……è¶³ï¼‰
2. è¯¦ç»†æè¿°å¤§ä¾¿æ€§çŠ¶å’Œé¢‘æ¬¡
3. å‘ŠçŸ¥æ˜¯å¦æœ‰å…¶ä»–ä¸é€‚ç—‡çŠ¶

å¾…ä¿¡æ¯å®Œå–„åï¼Œæˆ‘å°†ä¸ºæ‚¨å¼€å…·ä¸ªæ€§åŒ–çš„ä¸­è¯å¤„æ–¹ã€‚`
        };

        function displayTest(title, content, rawContent) {
            const container = document.getElementById('testResults');
            const testDiv = document.createElement('div');
            testDiv.className = 'test-container';
            
            // ä½¿ç”¨å¤„æ–¹æ¸²æŸ“å™¨å¤„ç†å†…å®¹
            let processedContent = content;
            if (window.prescriptionRenderer) {
                processedContent = window.prescriptionRenderer.renderContent(content, false, null);
            } else {
                // å¤‡ç”¨æ ¼å¼åŒ–
                processedContent = formatMessage(content);
            }
            
            testDiv.innerHTML = `
                <div class="test-title">${title}</div>
                <div class="message ai">
                    <div class="message-avatar">ğŸ‘¨â€âš•ï¸</div>
                    <div class="message-content">
                        <div class="message-text">${processedContent}</div>
                        <div class="message-time">${new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}</div>
                    </div>
                </div>
                <details>
                    <summary style="cursor: pointer; color: #6b7280; font-size: 13px;">æŸ¥çœ‹åŸå§‹å†…å®¹</summary>
                    <div class="raw-content">${rawContent}</div>
                </details>
            `;
            
            container.appendChild(testDiv);
        }

        // å¤‡ç”¨æ ¼å¼åŒ–å‡½æ•°ï¼ˆä»ä¸»é¡µé¢å¤åˆ¶ï¼‰
        function formatMessage(content) {
            if (!content) return '';
            
            return content
                .replace(/\*\*ã€å¤„æ–¹ã€‘\*\*/g, '<div style="background: linear-gradient(135deg, #2d5aa0, #4a7bc8); color: white; padding: 10px 15px; border-radius: 8px; margin: 15px 0; font-weight: bold; font-size: 16px; text-align: center;">ğŸ“‹ ä¸­è¯å¤„æ–¹</div>')
                .replace(/\*\*ã€(ç”¨æ³•|æ³¨æ„|ç¦å¿Œ|åŠŸæ•ˆ)ã€‘\*\*/g, '<div style="background: #f3f4f6; color: #374151; padding: 8px 12px; border-radius: 6px; margin: 10px 0; font-weight: bold; border-left: 4px solid #6b7280;">$1</div>')
                .replace(/\*\*ã€(.*?)ã€‘\*\*/g, '<strong style="color: #2d5aa0; font-size: 15px; background: #e0f2fe; padding: 2px 6px; border-radius: 4px;">ã€$1ã€‘</strong>')
                .replace(/\*\*(.*?)\*\*/g, '<strong style="color: #1f2937; font-weight: bold;">$1</strong>')
                .replace(/\*(.*?)\*/g, '<em style="color: #6b7280;">$1</em>')
                .replace(/#{5,}/g, '<hr style="margin: 20px 0; border: none; border-top: 2px solid #e5e7eb; background: linear-gradient(to right, #e5e7eb, transparent);">')
                .replace(/###\s*(.*?)(?=\n|$)/g, '<h4 style="margin: 20px 0 12px 0; color: #2d5aa0; font-size: 17px; font-weight: bold; padding-left: 8px; border-left: 4px solid #2d5aa0; background: #f8fafc;">$1</h4>')
                .replace(/##\s*(.*?)(?=\n|$)/g, '<h3 style="margin: 25px 0 15px 0; color: #1f2937; font-size: 19px; font-weight: bold; padding: 8px 12px; background: linear-gradient(135deg, #f3f4f6, #e5e7eb); border-radius: 6px;">$1</h3>')
                .replace(/^#\s*(.*?)(?=\n|$)/gm, '<h2 style="margin: 30px 0 20px 0; color: #111827; font-size: 22px; font-weight: bold; text-align: center; padding: 12px; background: linear-gradient(135deg, #dbeafe, #bfdbfe); border-radius: 8px;">$1</h2>')
                .replace(/([ä¸€-é¾Ÿ\u4e00-\u9fff]+)\s+(\d+)g/g, '<span style="display: inline-block; background: #ecfdf5; color: #065f46; padding: 2px 6px; margin: 1px 3px; border-radius: 4px; font-weight: 500; border: 1px solid #d1fae5;">$1 <strong>$2g</strong></span>')
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>')
                .replace(/(\d+\.\s)/g, '<br><span style="color: #2d5aa0; font-weight: bold;">$1</span>')
                .replace(/^<br>/, '');
        }

        function testSimpleDiagnosis() {
            displayTest('ğŸ“ ç®€å•è¯Šæ–­æµ‹è¯•', testCases.simpleDiagnosis, testCases.simpleDiagnosis);
        }

        function testStructuredDiagnosis() {
            displayTest('ğŸ—ï¸ ç»“æ„åŒ–è¯Šæ–­æµ‹è¯•', testCases.structuredDiagnosis, testCases.structuredDiagnosis);
        }

        function testPrescriptionContent() {
            displayTest('ğŸ’Š å¤„æ–¹å†…å®¹æµ‹è¯•', testCases.prescriptionContent, testCases.prescriptionContent);
        }

        function testMixedContent() {
            displayTest('ğŸ”€ æ··åˆå†…å®¹æµ‹è¯•', testCases.mixedContent, testCases.mixedContent);
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºçŠ¶æ€
        window.addEventListener('load', function() {
            console.log('âœ… æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('ğŸ“‹ å¤„æ–¹æ¸²æŸ“å™¨çŠ¶æ€:', window.prescriptionRenderer ? 'å·²åŠ è½½' : 'æœªåŠ è½½');
        });
    </script>
</body>
</html>