<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–ç™»å½•æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .card { border: 2px solid #ddd; padding: 20px; margin: 10px; cursor: pointer; text-align: center; }
        .card:hover { border-color: #667eea; }
        .card.selected { border-color: #667eea; background: #f0f4ff; }
        .form { background: #f9f9f9; padding: 15px; margin: 15px 0; display: none; }
        .form.show { display: block; }
        input { width: 100%; padding: 8px; margin: 5px 0; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .debug { background: #e3f2fd; padding: 10px; margin: 10px 0; font-size: 12px; }
    </style>
</head>
<body>
    <h2>ğŸ” ç®€åŒ–ç™»å½•åŠŸèƒ½æµ‹è¯•</h2>
    
    <div class="debug" id="debug">çŠ¶æ€: é¡µé¢åŠ è½½ä¸­...</div>
    
    <div class="card" onclick="testSelectRole('guest')" id="role-guest">
        ğŸŒ¿ ä¸´æ—¶è®¿å®¢ (ç‚¹å‡»æµ‹è¯•)
    </div>
    
    <div class="card" onclick="testSelectRole('doctor')" id="role-doctor">
        ğŸ‘¨â€âš•ï¸ åŒ»ç”Ÿ (ç‚¹å‡»æµ‹è¯•)
    </div>
    
    <div class="form" id="loginForm">
        <h3>ç™»å½•è¡¨å•</h3>
        <input type="text" id="username" placeholder="ç”¨æˆ·å">
        <input type="password" id="password" placeholder="å¯†ç ">
        <button onclick="testLogin()">ç™»å½•æµ‹è¯•</button>
    </div>
    
    <button onclick="resetTest()">é‡ç½®æµ‹è¯•</button>
    
    <script>
        let currentRole = null;
        
        function debug(msg) {
            const debugDiv = document.getElementById('debug');
            const timestamp = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `<br>[${timestamp}] ${msg}`;
            console.log('DEBUG:', msg);
        }
        
        function testSelectRole(role) {
            debug(`ğŸ“ selectRole('${role}') è¢«è°ƒç”¨`);
            currentRole = role;
            
            // æ¸…é™¤é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // é€‰ä¸­å½“å‰è§’è‰²
            const card = document.getElementById(`role-${role}`);
            if (card) {
                card.classList.add('selected');
                debug(`âœ… è§’è‰²å¡ç‰‡ ${role} å·²é€‰ä¸­`);
            } else {
                debug(`âŒ æ‰¾ä¸åˆ°è§’è‰²å¡ç‰‡: role-${role}`);
            }
            
            // æ˜¾ç¤º/éšè—è¡¨å•
            const form = document.getElementById('loginForm');
            if (role === 'guest') {
                form.classList.remove('show');
                debug('ğŸŒ¿ ä¸´æ—¶è®¿å®¢æ¨¡å¼ï¼Œéšè—ç™»å½•è¡¨å•');
            } else {
                form.classList.add('show');
                debug(`ğŸ” ${role} æ¨¡å¼ï¼Œæ˜¾ç¤ºç™»å½•è¡¨å•`);
                
                // è‡ªåŠ¨å¡«å……æµ‹è¯•è´¦å·
                if (role === 'doctor') {
                    document.getElementById('username').value = 'doctor';
                    document.getElementById('password').value = 'doctor123';
                    debug('ğŸ“ å·²å¡«å……åŒ»ç”Ÿæµ‹è¯•è´¦å·');
                }
            }
        }
        
        async function testLogin() {
            debug('ğŸ” å¼€å§‹æµ‹è¯•ç™»å½•...');
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            debug(`ğŸ“¤ å‘é€ç™»å½•è¯·æ±‚: ${username}`);
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                debug(`ğŸ“¥ ç™»å½•å“åº”çŠ¶æ€: ${response.status}`);
                
                const data = await response.json();
                debug(`ğŸ“‹ å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`);
                
                if (data.success) {
                    debug(`âœ… ç™»å½•æˆåŠŸ! è§’è‰²: ${data.user.role}, è·³è½¬: ${data.redirect_url}`);
                } else {
                    debug(`âŒ ç™»å½•å¤±è´¥: ${data.message}`);
                }
                
            } catch (error) {
                debug(`ğŸ’¥ ç½‘ç»œé”™è¯¯: ${error.message}`);
            }
        }
        
        function resetTest() {
            debug('ğŸ”„ é‡ç½®æµ‹è¯•');
            currentRole = null;
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('loginForm').classList.remove('show');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
        
        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            debug('ğŸ“„ é¡µé¢DOMåŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>